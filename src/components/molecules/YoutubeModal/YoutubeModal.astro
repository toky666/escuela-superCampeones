---
import { fetchLatestYouTubeVideo } from "@src/services/youtube";
import { YouTube } from "astro-embed";

let videoData;
try {
  videoData = await fetchLatestYouTubeVideo();
  console.log("entro video");
} catch (error) {
  videoData = null;
  console.log("NOOOOO entro video");
}
const fallbackVideoId = "cqMfPS8jPys"; //link de youtube en caso que no reconozca mi sitio
const fallbackThumbnail =
  videoData?.thumbnail ?? "https://www.youtube.com/watch?v=cqMfPS8jPys";
console.log("Video Data in YoutubeModal:", fallbackThumbnail);

const {
  id: videoId,
  thumbnail,
  title,
} = videoData || {
  id: fallbackVideoId,
  thumbnail: fallbackThumbnail,
};
---

<script>
  import { loadVideo } from "@controllers/VideoModal.controller";
  loadVideo();
</script>

{
  (
    <section class="youtube__modal__box">
      <div class="modal__close__button" />
      <div class="modal__container" id="portfolio-modal-youtube">
            <iconify-icon
      class="close-btn-youtube"
      icon="line-md:close-circle-twotone"
      width="34"
      height="34"
      style="color: #d3231a"></iconify-icon>
        <YouTube
          id={videoId}
          class="latestVideoEmbed"
          poster={thumbnail}
          title={title}
        />
      </div>
    </section>
  )
}
<style is:inline>
  lite-youtube {
    min-width: 100%;
    height: 100%;
  }
</style>

<style lang="scss">
  .youtube__modal__box {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1200;
  }
  .modal__close__button {
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.699);
  }
  .modal__container {
    position: absolute;
    width: 95%;
    max-width: 900px;
    height: 550px;
    overflow: hidden;
    border-radius: 12px;
    border: solid 2px #1d536e;
  }
   .close-btn-youtube {
    position: absolute; /* o relative si está dentro de un contenedor */
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.25rem 0.5rem;
    margin: 0; /* elimina cualquier margen */
    background-color: transparent;
    border: none;
    font-size: 1rem;
    cursor: pointer;
    z-index: 10; /* asegúrate que esté por encima pero no tape íconos */
  }

  .close-btn-youtube:focus {
    outline: none;
  }

  @media (max-width: 900px) {
    .modal__container {
      height: 500px;
    }
  }
  @media (max-width: 600px) {
    .modal__container {
      height: 400px;
    }
  }
  @media (max-width: 400px) {
    .modal__container {
      height: 350px;
    }
  }
</style>
